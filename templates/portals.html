<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="../static/style.css">
    <link rel="shortcut icon" type="image/png" href="../static/tv.png" />
    <title>STB Proxy</title>
</head>

<body>

    <div class="logobar">
        <img src="../static/tv.png" alt="logo" class="logo">
        <h4 class="title">STB Proxy</h4>
        <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=62MYXSBT75D4E"
            target="_blank"><img src="../static/beer.png" alt="donate" class="donate"></a>
        <a href="https://github.com/Chris230291/STB-Proxy" target="_blank"><img src="../static/github.png" alt="github"
                class="github"></a>
    </div>
    <br>
    <div class="topnav">
        <a class="active" href="/portals">Portals</a>
        <a href="/editor">Playlist Editor</a>
        <a href="/player">Player</a>
    </div>

    <br>

    <table>
        <tr>
            <th width="25%">Name</th>
            <th width="25%">Portal</th>
            <th width="15%">Mac</th>
            <th width="25%">Proxy</th>
            <th width="1%">Format</th>
            <th>Exipres</th>
            <th width="1%"></th>
            <th width="1%"></th>
        </tr>
        {% if portals is not none %}
        {% for portal in portals %}
        <tr>
            <form action="/portal/update" method="post">
                <td>
                    <input type="text" name="oname" class="textfield" value="{{ portal['name'] }}" hidden>
                    <input type="text" name="name" class="textfield" required pattern="{{ blacklists[loop.index0] }}"
                        title="Name must be unique and can only contain letters, numbers, underscores and dashes"
                        value="{{ portal['name'] }}">
                </td>
                <td><input type="text" name="url" class="textfield" required pattern="^(http|https):\/\/.*$"
                        title="Enter a valid URL starting with 'http|s://'" value="{{ portal['url'] }}"></td>
                <td><input type="text" name="mac" class="textfield" required
                        pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$" title="Enter a valid MAC address"
                        value="{{ portal['mac'] }}"></td>
                <td><input type="text" name="proxy" class="textfield" onchange="setFormat(this)"
                        pattern="^(http|https):\/\/.*$" title="Enter a valid URL starting with 'http|s://'"
                        value="{{ portal['proxy'] }}"></td>
                <td> <select name="format" data-format="{{ portal['format'] }}">
                        <option value="redirect">Redirect</option>
                        <option value="mp4">MP4</option>
                        <option value="hls">HLS</option>
                        <option value="mpegts">MPEG-TS</option>
                    </select></td>
                <td>{{ portal['expires'] }}</td>
                <td>
                    <input type="submit" class="buttonEditPortal" value="Update">
                </td>
            </form>
            <td>
                <form action="/portal/remove" method="post">
                    <button name="name" class="buttonRemovePortal" value="{{ portal['name'] }}">Remove</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        {% endif %}
        <tr>
            <form action="/portal/add" method="post">
                <td><input type="text" name="name" class="textfield" required pattern="{{ masterBlacklist }}"
                        title="Name must be unique and can only contain letters, numbers, underscores and dashes"></td>
                <td><input type="text" name="url" class="textfield" required pattern="^(http|https):\/\/.*$"
                        title="Enter a valid URL starting with 'http|s://'"></td>
                <td><input type="text" name="mac" class="textfield" required
                        pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$" title="Enter a valid MAC address"></td>
                <td><input type="text" name="proxy" class="textfield" onchange="setFormat(this)"
                        pattern="^(http|https):\/\/.*$" title="Enter a valid URL starting with 'http|s://'"></td>
                <td> <select name="format" data-format="redirect">
                        <option value="redirect">Redirect</option>
                        <option value="mp4">MP4</option>
                        <option value="hls">HLS</option>
                        <option value="mpegts">MPEG-TS</option>
                    </select></td>
                <td colspan="2"></td>
                <td><input type="submit" class="buttonAddPortal" value="Add"></td>
            </form>
        </tr>
    </table>

    <script>
        var formatLists = document.getElementsByName("format")
        for (var i = 0; i < formatLists.length; i++) {
            formatLists[i].value = formatLists[i].getAttribute('data-format');
            setFormat(formatLists[i]);
        }

        function setFormat(ele) {
            var row = ele.parentElement.parentElement;
            var proxy = row.querySelector('input[name="proxy"]').value;
            var format = row.querySelector('select[name="format"]');
            if (proxy !== "") {
                format.options[0].disabled = true;
                if (format.value == "redirect" || format.value == "") {
                    format.value = "mp4";
                }
            }
            else
                format.options[0].disabled = false;
        }
    </script>

</body>

</html>